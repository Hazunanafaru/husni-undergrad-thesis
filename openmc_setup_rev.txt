# INSTALL MINICONDA
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 1
cd ~/
mkdir miniconda
cd ~/miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-py38_4.10.3-Linux-x86_64.sh
bash Miniconda3-py38_4.10.3-Linux-x86_64.sh
source ~/.bashrc
conda config --set auto_activate_base false
source ~/.bashrc

# INSTALL ipykernel
conda activate base
conda install ipykernel
ipython kernel install --user --name=base

# INSTALL CADQUERY2
sudo apt-get install ffmpeg libsm6 libxext6  -y
conda install -c cadquery -c conda-forge cadquery=master

# INSTALL CMAKE, LAPACK, BLAS, EIGEN3, HDF5, AND GFORTRAN
sudo apt-get update
sudo apt-get install cmake libblas-dev liblapack-dev libeigen3-dev libhdf5-dev gfortran python3-pip -y

# INSTALL PYTHON REQUIREMENTS
cd ~/iter-tritium-breeding-xgboost
pip3 install -r jupyter-notebooks/requirements.txt
export PATH="/home/husninaufalz/.local/bin:$PATH"

# INSTALL MOAB
cd ~/
mkdir ~/MOAB
cd ~/MOAB
git clone -b Version5.1.0 https://bitbucket.org/fathomteam/moab/
cd ~/MOAB
mkdir ~/MOAB/build
cd ~/MOAB/build
cmake ../moab -DENABLE_HDF5=ON -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX=~/MOAB -DENABLE_PYMOAB=ON
export PYTHONPATH=/home/husninaufalz/MOAB/lib/python3.8/site-packages/:$PYTHONPATH
make
make test install
cd pymoab
sudo python3 setup.py install
env LD_LIBRARY_PATH=~/MOAB/lib:$LD_LIBRARY_PATH

# INSTALL DAGMC

cd ~/
mkdir ~/DAGMC
cd ~/DAGMC
git clone -b develop https://github.com/svalinn/dagmc
cd ~/DAGMC
mkdir ~/DAGMC/build
cd ~/DAGMC/build
cmake ../dagmc -DBUILD_TALLY=ON -DCMAKE_INSTALL_P=/home/husninaufalz/DAGMC -DMOAB_DIR=/home/husninaufalz/MOAB -DBUILD_STATIC_LIBS=OFF
make install
rm -rf ~/DAGMC/dagmc
env LD_LIBRARY_PATH=~/DAGMC/lib:$LD_LIBRARY_PATH


# %env FC=mpif90
# %env CC=mpicc

# INSTALL OPENMC (FROM DIFFERENT SOURCE)

cd ~/
git clone https://github.com/openmc-dev/openmc.git
cd ~/openmc
mkdir ~/openmc/build
cd ~/openmc/build
cmake -Ddagmc=ON -DCMAKE_PREFIX_PATH=~/DAGMC ..
make
sudo make install
export PATH="$PATH:/home/husninaufalz/openmc/build/bin"
sudo cp ~/openmc/build/bin/openmc /usr/local/bin

cd ~/openmc
pip3 install .

# DOWNLOAD ENDF/B-VIII.0 NUCLEAR DATA
cd ~/
mkdir ~/ND
wget -O ~/ND/endfb80.tar.xz https://anl.box.com/shared/static/uhbxlrx7hvxqw27psymfbhi7bx7s6u6a.xz
cd ~/ND
tar -xvf endfb80.tar.xz
rm endfb80.tar.xz

# SET NUCLEAR DATA VARIABLE
cd ~/
# sudo nano ~/.bashrc
# Add this line to the bottom of bashrc file
# export OPENMC_CROSS_SECTIONS='/home/husninaufalz/ND/endfb80_hdf5/cross_sections.xml'
# source ~/.bashrc

# INSTALL JUPYTERLAB
sudo pip3 install jupyterlab
sudo jupyter serverextension enable --py jupyterlab --sys-prefix
jupyter lab --ip 0.0.0.0 --port 8888 --no-browser
